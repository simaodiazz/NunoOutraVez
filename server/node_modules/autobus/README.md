# autobus

Bus for Node &amp; Browserify

-   [Purpose](#purpose)
-   [Installation](#installation)
-   [Usage](#usage-example)
-   [Methods](#methods)
    -   [join](#joinchannel-listener)
        -   [Wildcard Matching](#wildcard-matching)
    -   [send](#sendchannel-message)
    -   [publish](#publishchannel-message)
    -   [leave](#leavechannel-listener)

## Purpose

Send messages between channels and add listener functions to receive messages.

## Installation

```shell
npm install autobus
```

## Usage Example

```typescript
import AutoBus from 'autobus';

interface ChatMessage {
    text: string;
    user: string;
    date: Date;
}

const displayMessage = (message: ChatMessage) => {
    const { text, user, date } = message;
    const formattedDate = date.toTimeString().split(' ')[0];
    console.log(`[${formattedDate}] ${user}: ${text}`);
};

class ChatSession {
    constructor(autoBus: AutoBus, user: string) {
        this.autoBus = autoBus;
        this.user = user;
        this.init();
    }

    init() {
        this.autoBus.join('chat.channel', this.onMessageReceived.bind(this));
    }

    onMessageReceived(message: ChatMessage) {
        if (message.user === this.user) {
            return;
        }
        displayMessage(message);
    }

    publishMessage(message: string) {
        const chatMessage: ChatMessage = {
            text: message,
            user: this.user,
            date: new Date()
        };
        this.autoBus.publish('chat.channel', chatMessage);
    }
}

const autoBus = new AutoBus();

const session1 = new ChatSession(autoBus, 'User1');
const session2 = new ChatSession(autoBus, 'User2');

session1.publishMessage("Hello I'm User1");
session2.publishMessage("Hello I'm User2");
```

#### Example output

```
[12:30:28] User1: Hello I'm User1
[12:30:28] User2: Hello I'm User2
```

## Methods

### join(channel, listener)

Adds listener to channel (creates channel if it doesn't exist)

```typescript
const autoBus = new AutoBus();

const consoleLogData = (data: any) => {
    console.log(data);
};

autoBus.join('example.channel', consoleLogData);
```

#### Wildcard Matching

Join channel with wildcard name matching

```typescript
autoBus.join('*.channel', consoleLogData);
```

### send(channel, message)

Sends message to one listener on the channel, if there is more than one listener on the channel the method throws an error.

```typescript
autoBus.send('example.channel', 'example message');
```

### publish(channel, message)

Sends message to all listeners on the channel.

```typescript
autoBus.publish('example.channel', 'example message');
```

### leave(channel, listener)

Remove listener from channel

```typescript
autoBus.leave('example.channel', consoleLogData);
```
